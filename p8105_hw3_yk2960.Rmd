---
title: "p8105_hw3_yk2960"
author: "Youyuan(Keviant) Kong"
date: "2021/10/15"
output: github_document
##editor_options: 
##  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Liabrary installing...

```{r}
library(lubridate)
library(p8105.datasets)
library(tidyverse)
library(ggplot2)
library(ggridges)
library(dplyr)
library(patchwork)
library(leaflet)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "right"))


```

## Problem 1
```{r, include}
##p8105.datasets::brfss_smart2010
data("instacart")
##data("brfss_smart2010")
##distinct(instacart,eval_set)
##distinct(instacart,order_number)
##force(instacart)
a<-instacart %>%
  group_by(order_number) %>%
  summarize(
    n_obs = n(),
    n_days = n_distinct(user_id))


head(instacart,1)

##  filter(order_id==)
```
### Description

The dataset's size is
`r ncol(instacart)`
columns$\times$ `r nrow(instacart)` rows. 
It has `r ncol(instacart)` variables, which are:
`r colnames(instacart)` 
In these variables, 
eval_set is which evaluation set this order belongs in and
only have one value "`r distinct(instacart,eval_set)`". 
ordered has two possible values, 
1 if this product has been ordered by this user in the past,0 otherwise
order_number is the order sequence number for this user (1=first, n=nth)
Here is one example for the dataset and shows the type for each variable
`r head(instacart, 1) %>% knitr::kable()`

```{r}
str(head(instacart, 1))
```

### Number of Aisles

```{r}

aisle<-instacart %>%
  group_by(aisle,aisle_id) %>%
  summarize(n_items = n()) %>% 
  arrange(desc(n_items))
##    n_days = n_distinct(user_id))
```
There are`r nrow(aisle)` aisles, and the most popular one is `r aisle[1,1]`

### 
```{r}

aisle_ggplot<-
  aisle %>% 
  filter(n_items>10000) %>% 
  ggplot(aes(x = aisle_id, y = n_items))+
  geom_point()+
  geom_text(aes(label = aisle_id))  + 
##  facet_grid(. ~ aisle_id)+ 
  labs(
    title = "Aisle Top 10 plot",
    x = "aisle ID",
    y = "number of items")

##
aisle_ggplot
```
### Top 3 
```{r} 
three_aisle<-instacart %>% 
  filter(aisle=="baking ingredients"| 
           aisle=="dog food care"| 
           aisle=="packaged vegetables fruits")

three_aisle %>%
  group_by(product_name,aisle) %>%
  summarize(n_items = n()) %>% 
  arrange(desc(n_items)) %>% 
  filter(order(n_items, decreasing = TRUE)<=3) %>% 
  knitr::kable()

```

### 

```{r}

a<-instacart %>% 
  filter(product_name=="Pink Lady Apples"|
         product_name=="Coffee Ice Cream") %>% 
  group_by(order_dow,product_name) %>% 
  summarize(mean_hours = mean(order_hour_of_day)) %>% 
  pivot_wider(names_from=product_name,values_from =mean_hours ) %>%
  janitor::clean_names()%>% 
  mutate(order_dow=
         recode(order_dow,
                "0"="Sunday",
                "1"="Monday",
                "2"="Tuesday",
                "3"="Wednesday",
                "4"="Thursday",
                "5"="Friday",
                "6"="Saturday"))
```

```{r}
brfss<-p8105.datasets::brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic=="Overall Health") %>% 
  filter(response %in% c("Excellent",
                         "Very good",
                         "Good",
                         "Fair",
                         "Poor") ) %>% 
  mutate(response=forcats::fct_relevel(response, 
       c("Poor","Fair","Good", "Very good","Excellent")))

brfss %>% 
  filter(year==2002) %>% 
  select(locationabbr,locationdesc) %>% 
  unique () %>% 
  group_by(locationabbr) %>% 
  summarize(n_location = n()) %>% 
  arrange(desc(n_location)) %>% 
  filter(order(n_location,decreasing = TRUE)<=7)
  
brfss %>% 
  filter(year==2010) %>% 
  select(locationabbr,locationdesc) %>% 
  unique () %>% 
  group_by(locationabbr) %>% 
  summarize(n_location = n()) %>% 
  arrange(desc(n_location)) %>% 
  filter(order(n_location,decreasing = TRUE)<=7)


brfss %>% 
  distinct(response)

p8105.datasets::brfss_smart2010

```

```{r}
excellent<-brfss %>% 
  filter(response==("Excellent")) %>% 
  group_by(year,state=locationabbr) %>% 
  summarise(data_value=mean(data_value,na.rm=TRUE))
str(brfss$response)
excellent %>% 
  ggplot(aes(x=year,y=data_value,color=state))+
  geom_line()+  
  labs(
    title = "Excellent 50 States Data",
    x = "year",
    y = "data value")

```

```{r}
data_2006<-brfss %>% 
  filter(year==2006,locationabbr=="NY") 


data_2010<-brfss %>% 
  filter(year==2010,locationabbr=="NY")

plot_2006<-data_2006 %>% 
  ggplot(aes(y=data_value,x=response))+
  geom_boxplot()+
  labs(
    title = "2006 data distribution-response",
    x = "year",
    y = "data value")+
  theme(legend.position = "none")

plot_2010<-data_2010 %>% 
  ggplot(aes(y=data_value,x=response))+
  geom_boxplot()+
  labs(
    title = "2020 data distribution-response",
    x = "response",
    y = "data value")+
  theme(legend.position = "bottom")


(plot_2006+plot_2010)
```


```{r}
accelerometer<-read_csv("accel_data.csv")
```